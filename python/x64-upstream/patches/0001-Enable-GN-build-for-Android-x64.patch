From 7f10cf37ad6345a7d4d678950e9a344ac4a64e23 Mon Sep 17 00:00:00 2001
From: Zhenyu Liang <zhenyu.liang@intel.com>
Date: Thu, 20 Mar 2014 20:15:31 +0800
Subject: [PATCH 1/4] Enable GN build for Android x64

---
 build/config/android/config.gni  |    2 ++
 build/config/sysroot.gni         |    2 ++
 build/toolchain/android/BUILD.gn |   13 +++++++++++++
 3 files changed, 17 insertions(+)

diff --git a/build/config/android/config.gni b/build/config/android/config.gni
index 6a9080b..e892f53 100644
--- a/build/config/android/config.gni
+++ b/build/config/android/config.gni
@@ -41,6 +41,8 @@ if (is_android) {
 
   if (cpu_arch == "x86") {
     android_app_abi = "x86"
+  } else if (cpu_arch == "x64") {
+    android_app_abi = "x86_64"
   } else if (cpu_arch == "arm") {
     import("//build/config/arm.gni")
     if (arm_version < 7) {
diff --git a/build/config/sysroot.gni b/build/config/sysroot.gni
index cecc1ea..5be7c56 100644
--- a/build/config/sysroot.gni
+++ b/build/config/sysroot.gni
@@ -10,6 +10,8 @@ if (is_android) {
   if (!is_android_webview_build) {
     if (cpu_arch == "x86") {
       sysroot = "$android_ndk_root/platforms/android-14/arch-x86"
+    } else if (cpu_arch == "x64") {
+      sysroot = "$android_ndk_root/platforms/android-19/arch-x86_64"
     } else if (cpu_arch == "arm") {
       sysroot = "$android_ndk_root/platforms/android-14/arch-arm"
     } else if (cpu_arch == "mipsel") {
diff --git a/build/toolchain/android/BUILD.gn b/build/toolchain/android/BUILD.gn
index 8f84f69..f0e1842 100644
--- a/build/toolchain/android/BUILD.gn
+++ b/build/toolchain/android/BUILD.gn
@@ -28,6 +28,8 @@ if (is_gyp) {
     # Find the compiler for GYP for non-Clang Android.
     if (cpu_arch == "x86") {
       android_toolchain_arch = "x86-4.6"
+    } else if (cpu_arch == "x64") {
+      android_toolchain_arch = "x86_64-4.8"
     } else if (cpu_arch == "arm") {
       android_toolchain_arch = "arm-linux-androideabi-4.6"
     } else if (cpu_arch == "mipsel") {
@@ -85,6 +87,17 @@ gcc_toolchain("x86") {
   toolchain_os = "android"
 }
 
+gcc_toolchain("x64") {
+  prefix = "$android_ndk_root/toolchains/x86_64-4.8/prebuilt/$build_os-$android_host_arch/bin/x86_64-linux-android-"
+  cc  = prefix + "gcc"
+  cxx = prefix + "g++"
+  ar  = prefix + "ar"
+  ld  = cxx
+
+  toolchain_cpu_arch = "x64"
+  toolchain_os = "android"
+}
+
 gcc_toolchain("arm") {
   prefix = "$android_ndk_root/toolchains/arm-linux-androideabi-4.6/prebuilt/$build_os-$android_host_arch/bin/arm-linux-androideabi-"
   cc  = prefix + "gcc"
-- 
1.7.10.4

