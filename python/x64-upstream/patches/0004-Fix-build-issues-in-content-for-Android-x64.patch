From d8de2584936f12181b02dcced44146cf3e493200 Mon Sep 17 00:00:00 2001
From: Yang Gu <yang.gu@intel.com>
Date: Fri, 21 Feb 2014 22:06:39 +0800
Subject: [PATCH 04/12] Fix build issues in content/ for Android x64

---
 content/browser/android/content_view_core_impl.cc                     | 2 +-
 content/browser/android/content_view_core_impl.h                      | 2 +-
 content/browser/android/content_view_render_view.cc                   | 2 +-
 content/browser/android/content_view_render_view.h                    | 2 +-
 content/browser/renderer_host/render_widget_host_view_android.cc      | 4 ++--
 content/browser/renderer_host/render_widget_host_view_android.h       | 2 +-
 .../java/src/org/chromium/content/browser/ContentSettings.java        | 2 +-
 .../java/src/org/chromium/content/browser/ContentViewCore.java        | 4 ++--
 .../java/src/org/chromium/content/browser/input/ImeAdapter.java       | 4 ++--
 content/renderer/media/android/webmediaplayer_android.cc              | 2 +-
 10 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/content/browser/android/content_view_core_impl.cc b/content/browser/android/content_view_core_impl.cc
index 357d2a9..0e4c18c 100644
--- a/content/browser/android/content_view_core_impl.cc
+++ b/content/browser/android/content_view_core_impl.cc
@@ -1673,7 +1673,7 @@ bool ContentViewCoreImpl::GetUseDesktopUserAgent(
   return entry && entry->GetIsOverridingUserAgent();
 }
 
-void ContentViewCoreImpl::UpdateImeAdapter(int native_ime_adapter,
+void ContentViewCoreImpl::UpdateImeAdapter(long native_ime_adapter,
                                            int text_input_type,
                                            const std::string& text,
                                            int selection_start,
diff --git a/content/browser/android/content_view_core_impl.h b/content/browser/android/content_view_core_impl.h
index 1e63521..a454514 100644
--- a/content/browser/android/content_view_core_impl.h
+++ b/content/browser/android/content_view_core_impl.h
@@ -257,7 +257,7 @@ class ContentViewCoreImpl : public ContentViewCore,
                        const gfx::Vector2dF& content_offset,
                        float overdraw_bottom_height);
 
-  void UpdateImeAdapter(int native_ime_adapter, int text_input_type,
+  void UpdateImeAdapter(long native_ime_adapter, int text_input_type,
                         const std::string& text,
                         int selection_start, int selection_end,
                         int composition_start, int composition_end,
diff --git a/content/browser/android/content_view_render_view.cc b/content/browser/android/content_view_render_view.cc
index d009548..db42223 100644
--- a/content/browser/android/content_view_render_view.cc
+++ b/content/browser/android/content_view_render_view.cc
@@ -57,7 +57,7 @@ void ContentViewRenderView::Destroy(JNIEnv* env, jobject obj) {
 }
 
 void ContentViewRenderView::SetCurrentContentView(
-    JNIEnv* env, jobject obj, int native_content_view) {
+    JNIEnv* env, jobject obj, jlong native_content_view) {
   InitCompositor();
   ContentViewCoreImpl* content_view =
       reinterpret_cast<ContentViewCoreImpl*>(native_content_view);
diff --git a/content/browser/android/content_view_render_view.h b/content/browser/android/content_view_render_view.h
index a652864..6ac2831 100644
--- a/content/browser/android/content_view_render_view.h
+++ b/content/browser/android/content_view_render_view.h
@@ -26,7 +26,7 @@ class ContentViewRenderView : public CompositorClient {
 
   // Methods called from Java via JNI -----------------------------------------
   void Destroy(JNIEnv* env, jobject obj);
-  void SetCurrentContentView(JNIEnv* env, jobject obj, int native_content_view);
+  void SetCurrentContentView(JNIEnv* env, jobject obj, jlong native_content_view);
   void SurfaceCreated(JNIEnv* env, jobject obj);
   void SurfaceDestroyed(JNIEnv* env, jobject obj);
   void SurfaceChanged(JNIEnv* env, jobject obj,
diff --git a/content/browser/renderer_host/render_widget_host_view_android.cc b/content/browser/renderer_host/render_widget_host_view_android.cc
index 8db7f7c..8fa3e4e 100644
--- a/content/browser/renderer_host/render_widget_host_view_android.cc
+++ b/content/browser/renderer_host/render_widget_host_view_android.cc
@@ -458,8 +458,8 @@ void RenderWidgetHostViewAndroid::TextInputTypeChanged(
   // Unused on Android, which uses OnTextInputChanged instead.
 }
 
-int RenderWidgetHostViewAndroid::GetNativeImeAdapter() {
-  return reinterpret_cast<int>(&ime_adapter_android_);
+long RenderWidgetHostViewAndroid::GetNativeImeAdapter() {
+  return reinterpret_cast<intptr_t>(&ime_adapter_android_);
 }
 
 void RenderWidgetHostViewAndroid::OnTextInputStateChanged(
diff --git a/content/browser/renderer_host/render_widget_host_view_android.h b/content/browser/renderer_host/render_widget_host_view_android.h
index 9709180..ae538b1 100644
--- a/content/browser/renderer_host/render_widget_host_view_android.h
+++ b/content/browser/renderer_host/render_widget_host_view_android.h
@@ -220,7 +220,7 @@ class RenderWidgetHostViewAndroid
   void LockResources();
   void UnlockResources();
 
-  int GetNativeImeAdapter();
+  long GetNativeImeAdapter();
 
   void WasResized();
 
diff --git a/content/public/android/java/src/org/chromium/content/browser/ContentSettings.java b/content/public/android/java/src/org/chromium/content/browser/ContentSettings.java
index f8f0942..bd985d2 100644
--- a/content/public/android/java/src/org/chromium/content/browser/ContentSettings.java
+++ b/content/public/android/java/src/org/chromium/content/browser/ContentSettings.java
@@ -39,7 +39,7 @@ public class ContentSettings {
      * @param nativeContentSettings the native instance that is going away.
      */
     @CalledByNative
-    private void onNativeContentSettingsDestroyed(int nativeContentSettings) {
+    private void onNativeContentSettingsDestroyed(long nativeContentSettings) {
         assert mNativeContentSettings == nativeContentSettings;
         mNativeContentSettings = 0;
     }
diff --git a/content/public/android/java/src/org/chromium/content/browser/ContentViewCore.java b/content/public/android/java/src/org/chromium/content/browser/ContentViewCore.java
index 43e166f..f63c45f 100644
--- a/content/public/android/java/src/org/chromium/content/browser/ContentViewCore.java
+++ b/content/public/android/java/src/org/chromium/content/browser/ContentViewCore.java
@@ -2554,7 +2554,7 @@ public class ContentViewCore
     }
 
     @CalledByNative
-    private void updateImeAdapter(int nativeImeAdapterAndroid, int textInputType,
+    private void updateImeAdapter(long nativeImeAdapterAndroid, int textInputType,
             String text, int selectionStart, int selectionEnd,
             int compositionStart, int compositionEnd, boolean showImeIfNeeded, boolean requireAck) {
         TraceEvent.begin();
@@ -3407,7 +3407,7 @@ public class ContentViewCore
     private native void nativeEvaluateJavaScript(long nativeContentViewCoreImpl,
             String script, JavaScriptCallback callback, boolean startRenderer);
 
-    private native int nativeGetNativeImeAdapter(long nativeContentViewCoreImpl);
+    private native long nativeGetNativeImeAdapter(long nativeContentViewCoreImpl);
 
     private native int nativeGetCurrentRenderProcessId(long nativeContentViewCoreImpl);
 
diff --git a/content/public/android/java/src/org/chromium/content/browser/input/ImeAdapter.java b/content/public/android/java/src/org/chromium/content/browser/input/ImeAdapter.java
index b4e41b9..3b687ab 100644
--- a/content/public/android/java/src/org/chromium/content/browser/input/ImeAdapter.java
+++ b/content/public/android/java/src/org/chromium/content/browser/input/ImeAdapter.java
@@ -205,12 +205,12 @@ public class ImeAdapter {
         return mInputConnection != null && mInputConnection.isActive();
     }
 
-    private boolean isFor(int nativeImeAdapter, int textInputType) {
+    private boolean isFor(long nativeImeAdapter, int textInputType) {
         return mNativeImeAdapterAndroid == nativeImeAdapter &&
                mTextInputType == textInputType;
     }
 
-    public void attachAndShowIfNeeded(int nativeImeAdapter, int textInputType,
+    public void attachAndShowIfNeeded(long nativeImeAdapter, int textInputType,
             int selectionStart, int selectionEnd, boolean showIfNeeded) {
         mHandler.removeCallbacks(mDismissInput);
 
diff --git a/content/renderer/media/android/webmediaplayer_android.cc b/content/renderer/media/android/webmediaplayer_android.cc
index ba6000b..99bc11d 100644
--- a/content/renderer/media/android/webmediaplayer_android.cc
+++ b/content/renderer/media/android/webmediaplayer_android.cc
@@ -89,7 +89,7 @@ WebMediaPlayerAndroid::WebMediaPlayerAndroid(
       frame_(frame),
       client_(client),
       delegate_(delegate),
-      buffered_(1u),
+      buffered_(static_cast<size_t>(1)),
       main_loop_(base::MessageLoopProxy::current()),
       media_loop_(media_loop),
       ignore_metadata_duration_change_(false),
-- 
1.8.3.2

