From fd2c223bbc6a71e94e26bf65b3b5ba8a8086a863 Mon Sep 17 00:00:00 2001
From: Yang Gu <yang.gu@intel.com>
Date: Thu, 20 Feb 2014 15:10:17 +0800
Subject: [PATCH 3/9] jni fixes in net/ for Android x64

---
 net/android/java/src/org/chromium/net/AndroidKeyStore.java        | 2 +-
 net/android/java/src/org/chromium/net/DefaultAndroidKeyStore.java | 4 ++--
 net/android/keystore.cc                                           | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/net/android/java/src/org/chromium/net/AndroidKeyStore.java b/net/android/java/src/org/chromium/net/AndroidKeyStore.java
index 6db0d0a..8c85a47 100644
--- a/net/android/java/src/org/chromium/net/AndroidKeyStore.java
+++ b/net/android/java/src/org/chromium/net/AndroidKeyStore.java
@@ -135,7 +135,7 @@ public interface AndroidKeyStore {
      * @return The EVP_PKEY handle, as a 32-bit integer (0 if not available)
      */
     @CalledByNative
-    int getOpenSSLHandleForPrivateKey(AndroidPrivateKey key);
+    long getOpenSSLHandleForPrivateKey(AndroidPrivateKey key);
 
     /**
      * Called when the native OpenSSL engine no longer needs access to the underlying key.
diff --git a/net/android/java/src/org/chromium/net/DefaultAndroidKeyStore.java b/net/android/java/src/org/chromium/net/DefaultAndroidKeyStore.java
index 5232e46..67a57cc 100644
--- a/net/android/java/src/org/chromium/net/DefaultAndroidKeyStore.java
+++ b/net/android/java/src/org/chromium/net/DefaultAndroidKeyStore.java
@@ -207,9 +207,9 @@ public class DefaultAndroidKeyStore implements AndroidKeyStore {
                 return 0;
             }
             getPkeyContext.setAccessible(true);
-            int evp_pkey = 0;
+            long evp_pkey = 0;
             try {
-                evp_pkey = (Integer) getPkeyContext.invoke(opensslKey);
+                evp_pkey = (Long) getPkeyContext.invoke(opensslKey);
             } finally {
                 getPkeyContext.setAccessible(false);
             }
diff --git a/net/android/keystore.cc b/net/android/keystore.cc
index cefd4f4..de36c95 100644
--- a/net/android/keystore.cc
+++ b/net/android/keystore.cc
@@ -134,7 +134,7 @@ EVP_PKEY* GetOpenSSLSystemHandleForPrivateKey(jobject private_key_ref) {
   // Given that this routine shall only be called on Android < 4.2,
   // this won't be a problem in the far future (e.g. when Android gets
   // ported to 64-bit environments, if ever).
-  int pkey = Java_AndroidKeyStore_getOpenSSLHandleForPrivateKey(
+  long pkey = Java_AndroidKeyStore_getOpenSSLHandleForPrivateKey(
       env,
       GetKeyStore(private_key_ref).obj(),
       private_key_ref);
-- 
1.8.3.2

