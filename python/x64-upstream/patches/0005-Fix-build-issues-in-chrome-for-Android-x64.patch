From e7b91d8d075e8d68fefee29d9a79b016b8e4dc2d Mon Sep 17 00:00:00 2001
From: Yang Gu <yang.gu@intel.com>
Date: Thu, 27 Feb 2014 13:47:33 +0800
Subject: [PATCH 05/12] Fix build issues in chrome/ for Android x64

---
 .../src/org/chromium/chrome/browser/DevToolsServer.java  | 10 +++++-----
 .../chrome/browser/SSLClientCertificateRequest.java      | 16 ++++++++--------
 chrome/browser/android/dev_tools_server.cc               | 10 +++++-----
 chrome/browser/android/omnibox/omnibox_prerender.cc      |  2 +-
 .../browser/ui/android/ssl_client_certificate_request.cc |  4 ++--
 5 files changed, 21 insertions(+), 21 deletions(-)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/DevToolsServer.java b/chrome/android/java/src/org/chromium/chrome/browser/DevToolsServer.java
index bc47c10..7ed33f9 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/DevToolsServer.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/DevToolsServer.java
@@ -9,7 +9,7 @@ package org.chromium.chrome.browser;
  */
 public class DevToolsServer {
 
-    private int mNativeDevToolsServer = 0;
+    private long mNativeDevToolsServer = 0;
 
     public DevToolsServer(String socketNamePrefix) {
         mNativeDevToolsServer = nativeInitRemoteDebugging(socketNamePrefix);
@@ -28,8 +28,8 @@ public class DevToolsServer {
         nativeSetRemoteDebuggingEnabled(mNativeDevToolsServer, enabled);
     }
 
-    private native int nativeInitRemoteDebugging(String socketNamePrefix);
-    private native void nativeDestroyRemoteDebugging(int devToolsServer);
-    private native boolean nativeIsRemoteDebuggingEnabled(int devToolsServer);
-    private native void nativeSetRemoteDebuggingEnabled(int devToolsServer, boolean enabled);
+    private native long nativeInitRemoteDebugging(String socketNamePrefix);
+    private native void nativeDestroyRemoteDebugging(long devToolsServer);
+    private native boolean nativeIsRemoteDebuggingEnabled(long devToolsServer);
+    private native void nativeSetRemoteDebuggingEnabled(long devToolsServer, boolean enabled);
 }
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/SSLClientCertificateRequest.java b/chrome/android/java/src/org/chromium/chrome/browser/SSLClientCertificateRequest.java
index 4b0b6da..703eb64 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/SSLClientCertificateRequest.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/SSLClientCertificateRequest.java
@@ -54,9 +54,9 @@ public class SSLClientCertificateRequest {
         private AndroidPrivateKey mAndroidPrivateKey;
 
         // Pointer to the native certificate request needed to return the results.
-        private final int mNativePtr;
+        private final long mNativePtr;
 
-        CertAsyncTask(int nativePtr) {
+        CertAsyncTask(long nativePtr) {
             mNativePtr = nativePtr;
         }
 
@@ -106,7 +106,7 @@ public class SSLClientCertificateRequest {
         final Context mContext;
         final String mAlias;
 
-        CertAsyncTaskKeyChain(Context context, int nativePtr, String alias) {
+        CertAsyncTaskKeyChain(Context context, long nativePtr, String alias) {
             super(nativePtr);
             mContext = context;
             assert alias != null;
@@ -151,7 +151,7 @@ public class SSLClientCertificateRequest {
         private final String mHostName;
         private final int mPort;
 
-        CertAsyncTaskPKCS11(int nativePtr, String hostName, int port,
+        CertAsyncTaskPKCS11(long nativePtr, String hostName, int port,
                 PKCS11AuthenticationManager pkcs11CardAuthManager) {
             super(nativePtr);
             mHostName = hostName;
@@ -180,10 +180,10 @@ public class SSLClientCertificateRequest {
      * certificate selected by the user.
      */
     private static class KeyChainCertSelectionCallback implements KeyChainAliasCallback {
-        private final int mNativePtr;
+        private final long mNativePtr;
         private final Context mContext;
 
-        KeyChainCertSelectionCallback(Context context, int nativePtr) {
+        KeyChainCertSelectionCallback(Context context, long nativePtr) {
             mContext = context;
             mNativePtr = nativePtr;
         }
@@ -224,7 +224,7 @@ public class SSLClientCertificateRequest {
      * Note that nativeOnSystemRequestComplete will be called iff this method returns true.
      */
     @CalledByNative
-    private static boolean selectClientCertificate(final int nativePtr, final WindowAndroid window,
+    private static boolean selectClientCertificate(final long nativePtr, final WindowAndroid window,
             final String[] keyTypes, byte[][] encodedPrincipals, final String hostName,
             final int port) {
         ThreadUtils.assertOnUiThread();
@@ -305,5 +305,5 @@ public class SSLClientCertificateRequest {
 
     // Called to pass request results to native side.
     private static native void nativeOnSystemRequestCompletion(
-            int requestPtr, byte[][] certChain, AndroidPrivateKey androidKey);
+            long requestPtr, byte[][] certChain, AndroidPrivateKey androidKey);
 }
diff --git a/chrome/browser/android/dev_tools_server.cc b/chrome/browser/android/dev_tools_server.cc
index 6302666..5ab467a 100644
--- a/chrome/browser/android/dev_tools_server.cc
+++ b/chrome/browser/android/dev_tools_server.cc
@@ -439,27 +439,27 @@ bool RegisterDevToolsServer(JNIEnv* env) {
   return RegisterNativesImpl(env);
 }
 
-static jint InitRemoteDebugging(JNIEnv* env,
+static jlong InitRemoteDebugging(JNIEnv* env,
                                 jobject obj,
                                 jstring socket_name_prefix) {
   DevToolsServer* server = new DevToolsServer(
       base::android::ConvertJavaStringToUTF8(env, socket_name_prefix));
-  return reinterpret_cast<jint>(server);
+  return reinterpret_cast<intptr_t>(server);
 }
 
-static void DestroyRemoteDebugging(JNIEnv* env, jobject obj, jint server) {
+static void DestroyRemoteDebugging(JNIEnv* env, jobject obj, jlong server) {
   delete reinterpret_cast<DevToolsServer*>(server);
 }
 
 static jboolean IsRemoteDebuggingEnabled(JNIEnv* env,
                                          jobject obj,
-                                         jint server) {
+                                         jlong server) {
   return reinterpret_cast<DevToolsServer*>(server)->IsStarted();
 }
 
 static void SetRemoteDebuggingEnabled(JNIEnv* env,
                                       jobject obj,
-                                      jint server,
+                                      jlong server,
                                       jboolean enabled) {
   DevToolsServer* devtools_server = reinterpret_cast<DevToolsServer*>(server);
   if (enabled) {
diff --git a/chrome/browser/android/omnibox/omnibox_prerender.cc b/chrome/browser/android/omnibox/omnibox_prerender.cc
index 8c7b952..8c6a08c 100644
--- a/chrome/browser/android/omnibox/omnibox_prerender.cc
+++ b/chrome/browser/android/omnibox/omnibox_prerender.cc
@@ -63,7 +63,7 @@ void OmniboxPrerender::PrerenderMaybe(JNIEnv* env,
                                       jobject obj,
                                       jstring j_url,
                                       jstring j_current_url,
-                                      jint jsource_match,
+                                      jlong jsource_match,
                                       jobject j_profile_android,
                                       jobject j_tab) {
   AutocompleteResult* autocomplete_result =
diff --git a/chrome/browser/ui/android/ssl_client_certificate_request.cc b/chrome/browser/ui/android/ssl_client_certificate_request.cc
index e86eb27..a6f3359 100644
--- a/chrome/browser/ui/android/ssl_client_certificate_request.cc
+++ b/chrome/browser/ui/android/ssl_client_certificate_request.cc
@@ -105,7 +105,7 @@ void StartClientCertificateRequest(
   scoped_ptr<chrome::SelectCertificateCallback> request(
       new chrome::SelectCertificateCallback(callback));
 
-  jint request_id = reinterpret_cast<jint>(request.get());
+  jlong request_id = reinterpret_cast<intptr_t>(request.get());
 
   if (!chrome::android::
       Java_SSLClientCertificateRequest_selectClientCertificate(
@@ -144,7 +144,7 @@ namespace android {
 static void OnSystemRequestCompletion(
     JNIEnv* env,
     jclass clazz,
-    jint request_id,
+    jlong request_id,
     jobjectArray encoded_chain_ref,
     jobject private_key_ref) {
   DCHECK(content::BrowserThread::CurrentlyOn(content::BrowserThread::UI));
-- 
1.8.3.2

